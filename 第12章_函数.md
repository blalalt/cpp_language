## 12.1 函数声明

函数声明负责制定函数的名字、返回值的类型以及调用该函数所需的参数数量和类型。例如：

```c++
Elem* next_elem();
void exit(int);
double sqrt(double);
```

参数传递的语义和拷贝初始化的语义完全一致。如果需要的话还会执行隐式参数类型转换。

```c++
double s2 = sqrt(2);
double s3 = sqrt("three"); //错误，需要double的参数
```

函数的类型既包括返回类型也包括参数类型。对于成员函数，类的名字也是函数类型的一部分，**函数参数的名字不是**。

```c++
char& String::operator[](int); //类型: char& String::(int)
```

### 12.1.1 为什么使用函数

可维护性：把一个复杂的运算分解若干有意义的片段，分别命名。

易理解性：把计算任务分解为易于理解的小块(表示成函数或类)并为它们命名。

关于函数，应令其规模较小，最好控制在40行以内。

调用函数所产生的代价并不是影响程序性能的关键因素。

把函数视作代码的一种结构化机制。

### 12.1.2 函数声明的组成要件

函数声明除了指定函数的名字、一组参数以及函数的返回类型外，还可以包含很多**限定符和修饰符**：

* 函数的名字：必选
* 参数列表，可以为空()，必选
* 返回类型，可以是void，可以是前置或者后置形式(使用auto)，必选
* Inline，一种愿望，通过内联函数体实现函数调用
* constexpr，表示当给定常量表达式作为实参时，应该可以在编译时对函数求值
* noexcept，表示该函数不允许抛出异常
* 链接说明，例如static
* [[noreturn]]，表示该函数不会用常规的调用/返回机制返回结果

此外，**成员函数**还能被限定为：

* virtual：表示该函数可以被派生类覆盖
* override：表示该函数必须覆盖基类中的一个虚函数
* final：表示该函数不能被派生类覆盖
* static：表示该函数不与某一特定的对象关联
* const：表示该函数不能修改其对象的内容

```c++
struct S{
    [[noreturn]] virtual inline auto f(const unsigned long int* const) -> void const noexcept;
}
```

### 12.1.3 函数定义

若想调用，必先定义。定义是特殊的声明，给出函数体的内容。

函数的定义以及全部声明必须对应同一类型。为了C兼容，会自动忽略参数类型的顶层const。

```c++
// 下面两条声明语句对应的是同一个函数
void f(int); // 类型是 void(int)
void f(const int); // 类型是 void(int)
```

函数的参数名字不属于函数类型的一部分，不同的声明语句中参数的名字无须保持一致。

除了函数外，我们还能调用其他一些东西，它们遵循函数的大多数规则，比如参数传递规则：

* 构造函数：严格来说不是函数，没有返回值，无法得到其地址。
* 析构函数：不能被重载，无法得到其地址。
* 函数对象：不是函数（是对象），不能被重载
* lambda表达式：是定义函数对象的一种简写形式

### 12.1.4 返回值

每个函数声明都包含返回类型(除了构造函数和类型转换函数)。返回类型可以位于函数名字的前面或者后面。

```c++
int f(int a);
auto f2(int a) -> int;
```

auto关键字表示函数的返回类型位于参数列表之后，返回类型由->符合引导。

后置返回类型的必要性源于函数模板声明，因为其返回类型依赖于函数参数。

```c++
template<class T, class U>
auto product(const vector<T>& x, const vector<U>& y) -> decltype(x*y);
```

如果函数不返回返回值，则其返回类型是 void。

如果函数没有被声明成void，则它必须返回某个值(main函数除外)。void函数无权返回任何值。

与参数传递的语义类似，函数返回值的语义也与拷贝初始化的语义一致。return语句初始化一个返回类型的变量。编译器检查返回表达式的类型是否与函数的返回类型温和，并在必要时执行标准的或者用户自定义的类型转换。

```c++
double f(){return 1;} // 隐式地转换成 double{1}
```

当我们每次调用函数的时候，重新创建它的实参以及局部变量的拷贝。一旦函数返回了结果，所占的存储空间就被重新分配了。因此，**不应该返回指向局部非static变量的指针或引用**，我们无法预计该指针所指位置的内容将发生什么样的改变，

在函数中，"return"语句的形式属于如下5种之一：

* 执行一条return语句
* 跳转到函数末尾。只允许出现在无返回值的函数(void)以及main中。
* 抛出一个未被捕获的异常
* 在一个noexcept函数中抛出了一个异常并且没有局部捕获，造成程序终止。
* 直接或间接请求了一个无返回值的系统函数(如exit)

我们可以将一个未按常规方式(即通过return或“跳转到函数末尾”)返回的函数标记为[[noreturn]]

### 12.1.5 inline 函数

inline限定符告诉编译器，它应该尝试为函数的调用生成内联代码，但并非一定会，这依赖于编译器本身。此外，编译器和链接功能并非总是足够智能，我们应该令内联函数的定义位于作用域内(通常定义在头文件中)。